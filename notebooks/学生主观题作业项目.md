# 学生主观题作业项目总结
> 总结；项目逻辑非常复杂，前期一定要不断沟通，理清业务逻辑，并且开前端细分会议讨论

[TOC]
## 项目其他归档参考
- [wiki](http://wiki.ikuko.com/pages/viewpage.action?pageId=13272427)
- [rap服务端接口api](http://rap.ikuko.com/workspace/myWorkspace.do?projectId=162#1968)
- [ui设计稿](http://10.0.0.141:4001/19//wap/%E4%B8%BB%E8%A7%82%E9%A2%98H5_0523/index.html)

## 公共组件-答题卡（适用于答题、打分、解析页）
- 答题页显示已作答试题数；试题序号展示已做，未做
- 打分页显示已自主打分试题数；试题序号展示已自主打分，未自主打分
- 解析页
    - 客观题-可查看解析(正确，错误)
    - 客观题-不可查看解析(已做，未做)
    - 主观题-作业未截止(未打分->已做，未做；已打分->已自主打分，未自主打分)
    - 主观题-作业已截止(未打分->未做，未自主打分；已打分->已自主打分，未自主打分)
    - 主观题-作业批改已截止(未打分->未做，老师未打分；已打分->老师未打分，老师已打分)
    - 客观题+主观题-作业未截止(未打分->正确，错误，已做，未做；已打分->正确，错误，已自主打分，未自主打分)
    - 客观题+主观题-作业已截止(未打分->正确，错误，未做，未自主打分；已打分->正确，错误，已自主打分，未自主打分)
    - 客观题+主观题-作业批改已截止(未打分->正确，错误，未做，老师未打分；已打分->正确，错误，老师未打分，老师已打分)

## 路由页面
### 试题状态路由分发页（针对答题、打分、查看状态）
针对客户端作业详情页非听力作业入口所做的优化，前端、后端约定好一个统一的路由地址，客户端针对产品试题状态只需写死约定好的路由地址，减少多端后期沟通及维护成本；这样前端请求服务端一个接口，根据对于试题状态的返回值进行路由分发处理

----
### 学生答题页
#### 学生答题页-初始化逻辑
- 判断当前的试题索引，首屏展示第几道试题
- 根据当前试题索引，获取请求试题数据的页码
- 根据页码、每页请求数获取学生未答试题数据列表
- 针对学生有主观题作业情况（答题需拍照），判断app版本兼容逻辑，小于ios app版本3.4.5，android app版本3.5.0提示用户版本升级
- 针对学生有英语听力作业情况，判断app版本兼容逻辑，小于ios app版本3.4.1，android app版本3.4.6提示用户版本升级
- 获取学生未答试题接口后，针对试题列表为空处理
- 获取学生作业试题数据正常，学生可正常答题时，开始自动记录本次答题时间，每隔一秒递增；
- 判断轮播手势交互组件是否显示（本次作业只显示一次）
- 判断当前面板是第一道主观题显示答题拍照提示显示逻辑（本次作业只显示一次）
- 答题时长自动上报逻辑处理（每隔5s上报一次，页面在后台状态不上报）

#### 学生答题页-试题轮播切换逻辑
- 如果轮播手势交互组件显示，首次切换则隐藏
- 如果上一面板或下一面板无试题数据，则根据当前试题索引，获取请求试题数据的页码；然后根据页码、每页请求数获取学生未答试题数据列表
- 判断当前面板是第一道主观题显示答题拍照提示显示逻辑（只显示一次）
- 上报上一面板试题的答题时长，且开启每隔5s答题时长自动上报定时器

#### 学生答题页-底部按钮状态
- 如果当前切换面板是主观题试题，当前试题未答，显示拍照上传答案，否则显示重新拍照上传

#### 学生答题页-提交逻辑
- 提交之前需检测是否全部答完；
- 提交之前需最后一次上报答题时长，并取消时长自动上报定时器
- 答案提交成功且如果有主观题试题，全部作业试题答案都已提交，跳转到打分页路由，否则跳转到试题总览
- 提交失败需要处理作业已截止、作业被老师撤回情况

#### 学生答题页-优化逻辑
- 针对用户多次快速提交优化（正常情况下只允许一次提交请求）
- 答案提交成功后，返回按钮(安卓物理返回键)禁用，强制跳转到（试题总览或打分页）

----

### 学生打分页
#### 学生打分页-初始化逻辑
- 全量获取未打分试题数据列表（只包含试题id）
- 判断当前的试题索引，首屏展示第几道试题
- 根据当前试题索引，通过试题id获取当前试题的解析内容（题干，学生答案，选项...）
- 判断是否显示打分提示（所有题目已答完，非常棒！接下来需要对非选择题进行自主打分以完成作业...）

#### 学生打分页-底部按钮状态
- 当前试题未自主打分，自主打分，否则显示重新自主打分

#### 学生打分页-试题轮播切换逻辑
- 根据当前面板试题id获取试题解析内容

#### 学生打分页-提交逻辑
- 提交之前需检测是否已全部打分；
- 答案提交成功后跳转到试题总览
- 提交失败需要处理作业已截止、作业被老师撤回情况

#### 学生打分页-优化逻辑（同答题页）

----

### 学生试题查看总览页
#### 学生试题查看总览页-初始化逻辑
- 获取试题总览数据信息
- app版本判断逻辑【同答题页逻辑】（针对用户有两个手机，app高版本答完主观题，app低版本进入试题总览页的特殊情况）
- 如果有主观题作业，且作业批改已截止，提示学生：老师对你的作业进行了批改，你的得分更新了（每份作业判断一次）
- 作业到期截止时间倒计时处理，倒计时剩余时间未0，则重新请求试题总览数据信息，更新页面状态

#### 学生试题查看总览页-模版结构
- 客观题-针对只有客观题试题的作业展示
- 主观题-针对只有主观题试题的作业展示
- 客观题+主观题-针对有客观题+主观题试题的作业展示

#### 学生试题查看总览页-答题卡
- 需要处理同公共答题卡组件解析状态的各种逻辑（解析试题序号ui状态，场景，序号跳转逻辑不同，因此分开）
- 混合题型下判断在可打分状态下客观题试题序号为禁止状态（灰色，不可点击）
- 序号跳转针对可继续答题、继续打分、查看解析状态逻辑处理；当只有客观题，非即时作业且作业未截止，完成率100%情况下点击试题序号不做任何逻辑处理

#### 学生试题查看总览页-底部状态按钮展示（以下状态互斥）
- 继续答题
- 继续打分
- 查看解析
- 当只有客观题，非即时作业且作业未截止，完成率100%情况下，显示  2030-8-31 8:00公布答案 （文字灰色）

----
### 学生试题解析页
#### 学生试题解析页-初始化逻辑
- 全量获取未打分试题数据列表（只包含试题id）
- 判断当前的试题索引，首屏展示第几道试题
- 根据当前试题索引，通过试题id获取当前试题的解析内容（题干，学生答案，自主打分，老师打分，选项...）

#### 学生试题解析页-试题轮播切换逻辑
- 根据当前面板试题id获取试题解析内容

----
### 学生试题报告页
#### 学生试题报告页-初始化逻辑
- 预取作业报告数据（通过url是否带token区分开课啦app与微信 平台）
- 如果有主观题作业，且作业批改已截止，提示学生：老师对你的作业进行了批改，你的得分更新了（每份作业判断一次）
- 如果是微信平台，监听onbeforeunload事件，处理离开时的页面类型数据埋点

#### 学生试题报告页-页面模版结构
- 非听力作业报告（只包含客观题、只包含主观题、包含客观题+主观题）
- 听力作业报告
- 视频作业报告
- 底部报告统计字段文案说明
